var _0xfa4c=['config','general','paths','dbName','log','loading\x20device\x20database\x20[',']...','debug','error','device\x20database\x20loaded','info','nedb','path','exports','devices','devices.db','models','device','toDto','context','name','update','inflateDtos','findOne','deviceTypes','retrieveById','typeId','then','actions','events','type','roomId','meta','room','fromDto','inflateDto','all','join'];(function(_0x5319ea,_0x1b0fa7){var _0x2227b1=function(_0x55b4b5){while(--_0x55b4b5){_0x5319ea['push'](_0x5319ea['shift']());}};_0x2227b1(++_0x1b0fa7);}(_0xfa4c,0x187));var _0x191e=function(_0x54e9f3,_0x2ad329){_0x54e9f3=_0x54e9f3-0x0;var _0x15ed54=_0xfa4c[_0x54e9f3];return _0x15ed54;};'use strict';var Datastore=require(_0x191e('0x0'));var Path=require(_0x191e('0x1'));module[_0x191e('0x2')]={'initialize':function(_0x23e4e9,_0x5b7f74){_0x23e4e9[_0x191e('0x3')]={'dbName':_0x191e('0x4'),'create':function(_0x38ba61){return new Promise((_0x34b269,_0x57135c)=>{var _0x56980c=_0x23e4e9[_0x191e('0x5')][_0x191e('0x6')][_0x191e('0x7')](_0x38ba61);_0x23e4e9['db'][_0x191e('0x3')]['insert'](_0x56980c,(_0x25f6d7,_0x566378)=>{if(_0x25f6d7){_0x25f6d7[_0x191e('0x8')]={'entity':{'type':'device','id':_0x56980c[_0x191e('0x9')]}};_0x57135c(_0x25f6d7);}else{_0x34b269(_0x23e4e9[_0x191e('0x3')]['inflateDto'](_0x566378));}});});},'update':function(_0x7f7e90){return new Promise((_0x2434ba,_0x7aae0d)=>{var _0x37b461=_0x23e4e9[_0x191e('0x5')]['device'][_0x191e('0x7')](_0x7f7e90);_0x23e4e9['db'][_0x191e('0x3')][_0x191e('0xa')]({'_id':_0x37b461['_id']},_0x37b461,{},(_0x4af599,_0x4b2844)=>{if(_0x4af599){_0x4af599[_0x191e('0x8')]={'entity':{'type':_0x191e('0x6'),'id':_0x37b461[_0x191e('0x9')]}};_0x7aae0d(_0x4af599);}else{_0x2434ba(_0x4b2844==0x1);}});});},'delete':function(_0x5f57fb){return new Promise((_0x2e9fa2,_0x46aabf)=>{_0x23e4e9['db'][_0x191e('0x3')]['remove']({'_id':_0x5f57fb},{},(_0x373494,_0x306c00)=>{if(_0x373494){_0x46aabf(_0x373494);}else{_0x2e9fa2(_0x306c00==0x1);}});});},'retrieveAll':function(){return new Promise((_0x43aaee,_0x4f943c)=>{_0x23e4e9['db'][_0x191e('0x3')]['find']({},(_0x2e9f64,_0x50333b)=>{if(_0x2e9f64){_0x4f943c(_0x2e9f64);}else{_0x43aaee(_0x43aaee(_0x23e4e9[_0x191e('0x3')][_0x191e('0xb')](_0x50333b)));}});});},'retrieveByRoomId':function(_0x305d3c){return new Promise((_0x596e5a,_0x67cb03)=>{_0x23e4e9['db']['devices']['find']({'roomId':_0x305d3c},(_0x10719c,_0x4c94ae)=>{if(_0x10719c){_0x67cb03(_0x10719c);}else{_0x596e5a(_0x596e5a(_0x23e4e9[_0x191e('0x3')][_0x191e('0xb')](_0x4c94ae)));}});});},'retrieveByDeviceTypeId':function(_0xe18443){return new Promise((_0x222cce,_0xb177b7)=>{_0x23e4e9['db'][_0x191e('0x3')]['find']({'typeId':_0xe18443},(_0x5de13b,_0xa8537a)=>{if(_0x5de13b){_0xb177b7(_0x5de13b);}else{_0x222cce(_0x222cce(_0x23e4e9[_0x191e('0x3')][_0x191e('0xb')](_0xa8537a)));}});});},'retrieveById':function(_0x4745b9){return new Promise((_0x5c32bd,_0x49186d)=>{_0x23e4e9['db'][_0x191e('0x3')][_0x191e('0xc')]({'_id':_0x4745b9},(_0x22bce9,_0x530327)=>{if(_0x22bce9){_0x49186d(_0x22bce9);}else{_0x5c32bd(_0x23e4e9[_0x191e('0x3')]['inflateDto'](_0x530327));}});});},'inflateDto':function(_0x167a53){return new Promise((_0x9f2f3d,_0x16611d)=>{if(!_0x167a53)_0x9f2f3d(null);else{_0x23e4e9[_0x191e('0xd')][_0x191e('0xe')](_0x167a53[_0x191e('0xf')])[_0x191e('0x10')](_0xb51e85=>{delete _0xb51e85[_0x191e('0x11')];delete _0xb51e85[_0x191e('0x12')];_0x167a53[_0x191e('0x13')]=_0xb51e85;delete _0x167a53[_0x191e('0xf')];return _0x23e4e9['rooms'][_0x191e('0xe')](_0x167a53[_0x191e('0x14')]);})[_0x191e('0x10')](_0x1f67f4=>{if(_0x1f67f4){delete _0x1f67f4[_0x191e('0x15')];_0x167a53[_0x191e('0x16')]=_0x1f67f4;delete _0x167a53['roomId'];}_0x9f2f3d(_0x23e4e9[_0x191e('0x5')]['device'][_0x191e('0x17')](_0x167a53));});}});},'inflateDtos':function(_0x5a04bf){return new Promise((_0x488b11,_0x18096f)=>{var _0x253803=_0x5a04bf['map'](_0x5c0e73=>{return _0x23e4e9[_0x191e('0x3')][_0x191e('0x18')](_0x5c0e73);});Promise[_0x191e('0x19')](_0x253803)['then'](_0xa42a62=>{_0x488b11(_0xa42a62);});});}};return _0x5b7f74();},'start':function(_0x258867,_0x1f2d1a){var _0x2df87d=Path[_0x191e('0x1a')](_0x258867[_0x191e('0x1b')][_0x191e('0x1c')][_0x191e('0x1d')]['db'][0x0],_0x258867[_0x191e('0x3')][_0x191e('0x1e')]);_0x258867[_0x191e('0x1f')](_0x191e('0x20')+_0x2df87d+_0x191e('0x21'),_0x191e('0x22'));_0x258867['db']=_0x258867['db']||{};_0x258867['db'][_0x191e('0x3')]=new Datastore({'filename':_0x2df87d,'autoload':!![]});_0x258867['db'][_0x191e('0x3')]['ensureIndex']({'fieldName':_0x191e('0x9'),'unique':!![]},_0x35699f=>{if(_0x35699f)_0x258867[_0x191e('0x1f')](_0x35699f,_0x191e('0x23'));});_0x258867[_0x191e('0x1f')](_0x191e('0x24'),_0x191e('0x25'));return _0x1f2d1a();}};